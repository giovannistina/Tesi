from atproto_client import Client
import getpass
import os

def main():
    client = Client()
    username = input("USERNAME: ")
    password = getpass.getpass("PASSWORD: ")

    # effettua il login
    client.login(username, password)

    # ottieni la stringa di sessione serializzata (come usato negli script)
    try:
        session_string = client.session.export()
    except Exception:
        # fallback: alcuni SDK potrebbero esporre la sessione in modo diverso
        session_string = getattr(client, "session", None)
        if session_string is None:
            raise RuntimeError("Impossibile ottenere la sessione dal client.")
        session_string = session_string.export()

    # scrivi session.txt
    with open("session.txt", "w") as f:
        f.write(session_string)

    # restringi permessi file (Unix)
    try:
        os.chmod("session.txt", 0o600)
    except Exception:
        pass

    print("session.txt creato nella cartella corrente. NON committare questo file su Git.")

if __name__ == "__main__":
    main()
